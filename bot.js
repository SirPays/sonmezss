const Discord = require('discord.js');
const client = new Discord.Client();
const ayarlar = require('./ayarlar.json');
const chalk = require('chalk');
const moment = require('moment');
var Jimp = require('jimp');
const fs = require('fs');
var dispatcher  = null;
const http = require('http');
const express = require('express');
require('./util/eventLoader')(client);
const YouTube = require('simple-youtube-api');
const path = require('path');
const ffmpeg = require('ffmpeg-binaries');
const ytdl = require('ytdl-core');
const canvas = require('canvas');
const youtube = new YouTube("AIzaSyC2DG1Ilg9WJ8s7_05swukrLAdpeV7_K5U");
const db = require('quick.db');
var musicStream = ytdl( 'https://www.youtube.com/watch?v=Y75Km7dlt94');
global.queue = new Map()

var prefix = ayarlar.prefix;

const log = message => {
  console.log(`[${moment().format('YYYY-MM-DD HH:mm:ss')}] ${message}`);
};


client.on('message', async msg => {
  let ozelkomut = await db.fetch(`sunucuKomut_${msg.guild.id}`);
  let ozelkomutYazi;
  if (ozelkomut == null) ozelkomutYazi = 'BurayÄ± silme yoksa hatalÄ± olur'
  else ozelkomutYazi = ''+ ozelkomut +''
  if (msg.content.toLowerCase() === `${ozelkomutYazi}`) {
      let mesaj = await db.fetch(`sunucuMesaj_${msg.guild.id}`);
  let mesajYazi;
  if (mesaj == null) mesajYazi = 'BurayÄ± silme yoksa hatalÄ± olur'
  else mesajYazi = ''+ mesaj +''
    msg.channel.send(mesajYazi)
  }
});

client.commands = new Discord.Collection();
client.aliases = new Discord.Collection();
fs.readdir('./komutlar/', (err, files) => {
  if (err) console.error(err);
  log(`${files.length} komut yÃ¼klenecek.`);
  files.forEach(f => {
    let props = require(`./komutlar/${f}`);
    log(`YÃ¼klenen komut: ${props.help.name}.`);
    client.commands.set(props.help.name, props);
    props.conf.aliases.forEach(alias => {
      client.aliases.set(alias, props.help.name);
    });
  });
});

client.reload = command => {
  return new Promise((resolve, reject) => {
    try {
      delete require.cache[require.resolve(`./komutlar/${command}`)];
      let cmd = require(`./komutlar/${command}`);
      client.commands.delete(command);
      client.aliases.forEach((cmd, alias) => {
        if (cmd === command) client.aliases.delete(alias);
      });
      client.commands.set(command, cmd);
      cmd.conf.aliases.forEach(alias => {
        client.aliases.set(alias, cmd.help.name);
      });
      resolve();
    } catch (e){
      reject(e);
    }
  });
};

client.load = command => {
  return new Promise((resolve, reject) => {
    try {
      let cmd = require(`./komutlar/${command}`);
      client.commands.set(command, cmd);
      cmd.conf.aliases.forEach(alias => {
        client.aliases.set(alias, cmd.help.name);
      });
      resolve();
    } catch (e){
      reject(e);
    }
  });
};

client.unload = command => {
  return new Promise((resolve, reject) => {
    try {
      delete require.cache[require.resolve(`./komutlar/${command}`)];
      let cmd = require(`./komutlar/${command}`);
      client.commands.delete(command);
      client.aliases.forEach((cmd, alias) => {
        if (cmd === command) client.aliases.delete(alias);
      });
      resolve();
    } catch (e){
      reject(e);
    }
  });
};



client.elevation = message => {
  if(!message.guild) {
	return; }
  let permlvl = 0;
  if (message.member.hasPermission("BAN_MEMBERS")) permlvl = 2;
  if (message.member.hasPermission("ADMINISTRATOR")) permlvl = 3;
  if (message.author.id === ayarlar.sahip) permlvl = 4;
  return permlvl;
};

var regToken = /[\w\d]{24}\.[\w\d]{6}\.[\w\d-_]{27}/g;
// client.on('debug', e => {
//   console.log(chalk.bgBlue.green(e.replace(regToken, 'that was redacted')));
// });

client.on('warn', e => {
  console.log(chalk.bgYellow(e.replace(regToken, 'that was redacted')));
});

client.on('error', e => {
  console.log(chalk.bgRed(e.replace(regToken, 'that was redacted')));
});




client.on("message", message => {
    const dmchannel = client.channels.find("name", "dm-log");
    if (message.channel.type === "dm") {
        if (message.author.bot) return;
        dmchannel.sendMessage("", {embed: {
            color: 3447003,
            title: `GÃ¶nderen: ${message.author.tag}`,
            description: `Bota Ã–zelden GÃ¶nderilen DM: ${message.content}`
        }})
    }
});



  
  client.on('message', msg => {  
   if (msg.content.toLowerCase() === 'sa') {
      msg.reply('**VE AleykÃ¼m selam! ,  HoÅŸ Geldin :rose:**');
      msg.react("??")
      msg.react("??")
	}
  
  
    if (msg.content.toLowerCase() === prefix + 'izmirmarÅŸÄ±') {
	msg.channel.sendMessage('-------------------------------------');
    msg.channel.sendMessage('Ä°zmirin daÄŸlarÄ±nda Ã§iÃ§ekler aÃ§ar. ');
	msg.channel.sendMessage('AltÄ±n gÃ¼neÅŸ orda sÄ±rmalar saÃ§ar. ');
	    msg.channel.sendMessage('BozulmuÅŸ dÃ¼ÅŸmanlar yel gibi kaÃ§ar. ');
		    msg.channel.sendMessage('YaÅŸa Mustafa Kemal PaÅŸa,yaÅŸa ');
			    msg.channel.sendMessage('AdÄ±n yazÄ±lacak mÃ¼cevher taÅŸa. ');
				    msg.channel.sendMessage('-------------------------------------');
					    msg.channel.sendMessage('Ä°zmir daÄŸlarÄ±na bomba koydular ');
						    msg.channel.sendMessage('TÃ¼rkÃ¼n sancaÄŸÄ±nÄ± Ã¶ne koydular ');
							    msg.channel.sendMessage('ÅžanlÄ± zaferlerle dÃ¼ÅŸmanÄ± boÄŸdular. ');
								    msg.channel.sendMessage('Kader bÃ¶yle imiÅŸ ey garip ana ');
									    msg.channel.sendMessage('KanÄ±m feda olsun gÃ¼zel vatana. ');
										    msg.channel.sendMessage('-------------------------------------');
											    msg.channel.sendMessage('Ä°zmirin daÄŸlarÄ±nda oturdum kaldÄ±m ');
												    msg.channel.sendMessage('Åžehit olanlarÄ± deftere yazdim. ');
													    msg.channel.sendMessage('Ã–ksÃ¼z yavrularÄ± baÄŸrÄ±ma bastÄ±m ');
														    msg.channel.sendMessage('Kader bÃ¶yle imiÅŸ ey garip ana ');
															    msg.channel.sendMessage('Kanim feda olsun gÃ¼zel vatana ');
																    msg.channel.sendMessage('-------------------------------------');
																	    msg.channel.sendMessage('TÃ¼rk oÄŸluyum ben Ã¶lmek isterim. ');
																		    msg.channel.sendMessage('Toprak diken olsa yataÄŸÄ±m yerim ');
																			    msg.channel.sendMessage('AllahÄ±ndan utansÄ±n dÃ¶nenler geri ');
																				    msg.channel.sendMessage('YaÅŸa Mustafa Kemal PaÅŸa,yaÅŸa ');
																					    msg.channel.sendMessage('AdÄ±n yazÄ±lacak mÃ¼cevher taÅŸa.');
																						    msg.channel.sendMessage('-------------------------------------');						
																							}


	if (msg.content.toLowerCase() === prefix + 'istiklalmarÅŸÄ±') {
	msg.channel.sendMessage('-------------------------------------');
    msg.channel.sendMessage('Korkma, sÃ¶nmez bu ÅŸafaklarda yÃ¼zen al sancak;');
	msg.channel.sendMessage('SÃ¶nmeden yurdumun Ã¼stÃ¼nde tÃ¼ten en son ocak.');
	    msg.channel.sendMessage('O benim milletimin yÄ±ldÄ±zÄ±dÄ±r, parlayacak;');
		    msg.channel.sendMessage('O benimdir, o benim milletimindir ancak.');
				    msg.channel.sendMessage('-------------------------------------');
					    msg.channel.sendMessage('Ã‡atma, kurban olayÄ±m, Ã§ehrene ey nazlÄ± hilal!');
						    msg.channel.sendMessage('Kahraman Ä±rkÄ±ma bir gÃ¼l... Ne bu ÅŸiddet, bu celal?');
							    msg.channel.sendMessage('Sana olmaz dÃ¶kÃ¼len kanlarÄ±mÄ±z sonra helal;');
								    msg.channel.sendMessage('HakkÄ±dÄ±r, Hakka tapan, milletimin istiklal.');
										    msg.channel.sendMessage('-------------------------------------');
                           }
  
          if (msg.content.toLowerCase() === prefix + 'gif')  {
  	if (Math.floor((Math.random() * 13) + 1) === 1) {
   		msg.channel.sendMessage('https://media.giphy.com/media/1TSUKOv4k56aIryKAP/giphy.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 2) {
   		msg.channel.sendMessage('https://media.giphy.com/media/ASzK5wWjMtc6A/giphy.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 3) {
   		msg.channel.sendMessage('https://media.giphy.com/media/E9oadOOmD27jG/giphy.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 4) {
   		msg.channel.sendMessage('https://media.giphy.com/media/O1GhSbro4z4Dm/giphy.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 5) {
   		msg.channel.sendMessage('https://media.giphy.com/media/ASzK5wWjMtc6A/giphy.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 6) {
   		msg.channel.sendMessage('https://media.giphy.com/media/E9oadOOmD27jG/giphy.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 7) {
   		msg.channel.sendMessage('https://media.giphy.com/media/O1GhSbro4z4Dm/giphy.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 8) {
   		msg.channel.sendMessage('https://media.giphy.com/media/ND6xkVPaj8tHO/giphy.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 9) {
   		msg.channel.sendMessage('https://media.giphy.com/media/w60oAqglSRa1icDwO1/giphy.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 10) {
   		msg.channel.sendMessage('https://media.giphy.com/media/WFEGOIIrj6SY0/giphy.gif');
   }else if (Math.floor((Math.random() * 13) + 1) === 11) {
   		msg.channel.sendMessage('https://media.giphy.com/media/ND6xkVPaj8tHO/giphy.gif');
	}else if (Math.floor((Math.random() * 13) + 1) === 12) {
   		msg.channel.sendMessage('https://media.giphy.com/media/ND6xkVPaj8tHO/giphy.gif');
	}else if (Math.floor((Math.random() * 13) + 1) === 13) {
   		msg.channel.sendMessage('https://media.giphy.com/media/ND6xkVPaj8tHO/giphy.gif');
   }
  }
  
          if (msg.content.toLowerCase() === prefix + 'pokemon') {
  	if (Math.floor((Math.random() * 13) + 1) === 1) {
   		msg.channel.sendMessage('http://www.hareketligifler.net/data/media/1446/pokemon-hareketli-resim-0100.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 2) {
   		msg.channel.sendMessage('http://www.hareketligifler.net/data/media/1446/pokemon-hareketli-resim-0095.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 3) {
   		msg.channel.sendMessage('http://www.hareketligifler.net/data/media/1446/pokemon-hareketli-resim-0007.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 4) {
   		msg.channel.sendMessage('http://www.hareketligifler.net/data/media/1446/pokemon-hareketli-resim-0102.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 5) {
   		msg.channel.sendMessage('http://www.hareketligifler.net/data/media/1446/pokemon-hareketli-resim-0092.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 6) {
   		msg.channel.sendMessage('http://www.hareketligifler.net/data/media/1446/pokemon-hareketli-resim-0081.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 7) {
   		msg.reply('http://www.hareketligifler.net/data/media/1446/pokemon-hareketli-resim-0082.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 8) {
   		msg.channel.sendMessage('http://www.hareketligifler.net/data/media/1446/pokemon-hareketli-resim-0073.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 9) {
   		msg.reply('http://www.hareketligifler.net/data/media/1446/pokemon-hareketli-resim-0039.gif');
   	}else if (Math.floor((Math.random() * 13) + 1) === 10) {
   		msg.channel.sendMessage('http://www.hareketligifler.net/data/media/1446/pokemon-hareketli-resim-0017.gif');
   }else if (Math.floor((Math.random() * 13) + 1) === 11) {
   		msg.channel.sendMessage('http://www.hareketligifler.net/data/media/1446/pokemon-hareketli-resim-0040.gif');
	}else if (Math.floor((Math.random() * 13) + 1) === 12) {
   		msg.channel.sendMessage('http://www.hareketligifler.net/data/media/1446/pokemon-hareketli-resim-0021.gif');
	}else if (Math.floor((Math.random() * 13) + 1) === 13) {
   		msg.channel.sendMessage('http://www.hareketligifler.net/data/media/1446/pokemon-hareketli-resim-0009.gif');
   }
  }
  
          if (msg.content.toLowerCase() === prefix + 'zarat') {
  	if (Math.floor((Math.random() * 13) + 1) === 1) {
   		msg.channel.sendMessage('??1');
   	}else if (Math.floor((Math.random() * 13) + 1) === 2) {
   		msg.channel.sendMessage('??2');
   	}else if (Math.floor((Math.random() * 13) + 1) === 3) {
   		msg.channel.sendMessage('??3');
   	}else if (Math.floor((Math.random() * 13) + 1) === 4) {
   		msg.channel.sendMessage('??4');
   	}else if (Math.floor((Math.random() * 13) + 1) === 5) {
   		msg.channel.sendMessage('??5');
   	}else if (Math.floor((Math.random() * 13) + 1) === 6) {
   		msg.channel.sendMessage('??6');
   	}else if (Math.floor((Math.random() * 13) + 1) === 7) {
   		msg.channel.sendMessage('??6');
   	}else if (Math.floor((Math.random() * 13) + 1) === 8) {
   		msg.channel.sendMessage('??5');
   	}else if (Math.floor((Math.random() * 13) + 1) === 9) {
   		msg.channel.sendMessage('??-4');
   	}else if (Math.floor((Math.random() * 13) + 1) === 10) {
   		msg.channel.sendMessage('??3');
   }else if (Math.floor((Math.random() * 13) + 1) === 11) {
   		msg.channel.sendMessage('??2');
	}else if (Math.floor((Math.random() * 13) + 1) === 12) {
   		msg.channel.sendMessage('??1');
	}else if (Math.floor((Math.random() * 13) + 1) === 13) {
   		msg.channel.sendMessage('??1');
   }
  }
            if (msg.content.toLowerCase() === prefix + 'dolar') {
    msg.channel.sendMessage(' http://bigpara.hurriyet.com.tr/doviz/dolar/ ');
  }
  
              if (msg.content.toLowerCase() === prefix + 'Ã§izgi') {
    msg.channel.sendMessage('--------------------------------------------------------------------------------------------------------');
  }
});

 client.on('message', async message => { 
  if (message.content.toLowerCase() === prefix + 'davetim') {
   /* invites.then(function (a) {
            console.log(a.filter(invite => !invite.maxAge).first().toString());
        }); */
        try {
            const invites = await message.guild.fetchInvites();
            message.author.send(invites.filter(invite => !invite.maxAge).first().toString());
        } catch(err){
            message.delete();
            message.author.send("HiÃ§ bir kiÅŸiyi davet etmemiÅŸsin!")
        }
    }
});

client.on( 'message', function( msg ) {
	/**
	 * Message starts with command prefix.
	 */
	if ( msg.content.startsWith( prefix ) ) {
		var message = msg.content.slice( prefix.length );
		var command = message.match( /(^[^ ]+)/ )[ 1 ];

		switch ( command ) {
			/**
			 * !join - Joins the users voice channel.
			 */
			case 'join' :
				var voiceChannel = msg.member.voiceChannel;

				if ( typeof voiceChannel == 'undefined' ) {
					msg.reply( `:thinking: Sana katÄ±lmam iÃ§in ses kanalÄ±nda olman gerekiyor.` );
				} else {
					connectToVoice( msg, voiceChannel );
				}

				break;
			
			case 'leave' :
				var voiceConnection = msg.guild.voiceConnection;

				if ( voiceConnection ) {
					voiceConnection.disconnect();
					msg.reply( `:wave: p!leave komutunu kullandÄ±n!` );
				} else {
					msg.reply( `:thinking: Åžu anda bir ses kanalÄ±nda deÄŸilim.` );
				}

				break;
		
			default:
				break;
		}
	}
} );

function connectToVoice( msg, voiceChannel ) {
	voiceChannel.join().then( function( connection ) {
		dispatcher = connection.playStream( musicStream, { volume: 10 } );
		msg.reply( `:white_check_mark: Joined ${ msg.member.voiceChannel.name }.` );
	} ).catch( function( err ) {
		console.log( err );
	} );
}


client.on('guildCreate', guild => {
    let channel = client.channels.get("531866120555069450")
        const embed = new Discord.RichEmbed()
        .setColor("GREEN")
        .setAuthor(`GIRIS YAPTIM`)
        .setThumbnail(guild.iconURL)
        .addField("Sunucu", guild.name)
        .addField("Kurucu", guild.owner)
        .addField("Sunucu ID", guild.id, true)
        .addField("Toplam KullanÄ±cÄ±", guild.memberCount, true)
        .addField("Toplam Kanal", guild.channels.size, true)
         channel.send(embed);
    });
client.on('guildDelete', guild => {
    let channel = client.channels.get("531866416417210389")
        const embed = new Discord.RichEmbed()
        .setColor("RED")
        .setAuthor(`BENI ATTILAR`)
        .setThumbnail(guild.iconURL)
        .addField("Sunucu", guild.name)
        .addField("Kurucu", guild.owner)
        .addField("Sunucu ID", guild.id, true)
        .addField("Toplam KullanÄ±cÄ±", guild.memberCount, true)
        .addField("Toplam Kanal", guild.channels.size, true)
         channel.send(embed);
    });

client.on('message', async message => {
  const ms = require('ms');
  const args = message.content.slice(prefix.length).trim().split(/ +/g);
  const command = args.shift().toLowerCase();
  let u = message.mentions.users.first() || message.author;
  if (command === "stattemizle" ||command === "paneltemizle") {
  if (!message.guild.channels.find(channel => channel.name === "Sonmeztv | Sunucu Ä°statistik")) return message.channel.send(" Ä°statistik ayarlanmamÄ±ÅŸ.")
  if (!message.member.hasPermission('ADMINISTRATOR'))
  return message.channel.send(" Yetkin bulunmuyor.");
      const a = message.guild.channels.find(channel => channel.name === "Sonmeztv | Sunucu Ä°statistik").delete()
      if(!a) return console.log("guildStats")
      const b = message.guild.channels.find(channel => channel.name === `Ãœye sayÄ±sÄ±: ${message.guild.memberCount}`).delete()
      if(!b) return console.log("guildStatsMember")
      const c = message.guild.channels.find(channel => channel.name === `Bot sayÄ±sÄ±: ${message.guild.members.filter(m => m.user.bot).size}`).delete()
      if(!c) return console.log("guildStatsBot")
      const d = message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size}`).delete() //|| message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-1}`).delete() || message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-1}`).delete() || message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-2}`).delete()
      if(!d) return console.log("guildStatsChannel")
      message.channel.send(" Kanallar temizlendi.")
    }
  if (command === "statayarla" ||command === "panelayarla") {
  if (message.guild.channels.find(channel => channel.name === "Sonmeztv | Sunucu Ä°statistik")) return message.channel.send(" Zaten istatistik ayarlanmÄ±ÅŸ.")
  if (!message.member.hasPermission('ADMINISTRATOR'))
  return message.channel.send(" Yetkin bulunmuyor.");
  message.channel.send(`Kategori ve kanal kurulumu baÅŸlatÄ±lsÄ±n mÄ±? baÅŸlatÄ±lacak ise **yes** yazÄ±nÄ±z.`)
      message.channel.awaitMessages(response => response.content === 'yes', {
        max: 1,
        time: 10000,
        errors: ['time'],
      })
    .then((collected) => {
   message.guild.createChannel('Sonmeztv | Sunucu Ä°statistik', 'category', [{
  id: message.guild.id,
  deny: ['CONNECT'],
  deny: ['VIEW_CHANNEL']
}]);

 message.guild.createChannel(`Ãœye sayÄ±sÄ±: ${message.guild.memberCount}`, 'voice')
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "Ñ•ÏƒÎ·Ð¼Ñ”zÑ‚Î½ | Sunucu Ä°statistik")));
 message.guild.createChannel(`Bot sayÄ±sÄ±: ${message.guild.members.filter(m => m.user.bot).size}`, 'voice')
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "Ñ•ÏƒÎ·Ð¼Ñ”zÑ‚Î½ | Sunucu Ä°statistik")));
message.guild.createChannel(`Kanal sayÄ±sÄ±: ${message.guild.channels.size}`, 'voice')
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "Ñ•ÏƒÎ·Ð¼Ñ”zÑ‚Î½ | Sunucu Ä°statistik")));
  message.channel.send(" Sunucu paneli ayarlandÄ±!")
        })
}
});


client.on("message", async msg => {
  
 if (msg.channel.type === "dm") return;
 if(msg.author.bot) return;  
  
  if (msg.content.length > 7) {
    
  db.add(`puancik_${msg.author.id + msg.guild.id}`, 3)
};

  if (db.fetch(`puancik_${msg.author.id + msg.guild.id}`) > 150) {
    
   db.add(`seviye_${msg.author.id + msg.guild.id}`, 1)
    
 db.delete(`puancik_${msg.author.id + msg.guild.id}`)
    
};
  
});


const queue = new Map();

var servers = {};
var prefix = 'n!';


client.on('message', async msg => { // eslint-disable-line
 
        if (msg.author.bot) return undefined;
        if (!msg.content.startsWith(ayarlar.prefix)) return undefined;
 
        const args = msg.content.split(' ');
        const searchString = args.slice(1).join(' ');
        const url = args[1] ? args[1].replace(/<(.+)>/g, '$1') : '';
        const serverQueue = queue.get(msg.guild.id);
 
        let command = msg.content.toLowerCase().split(' ')[0];
        command = command.slice(prefix.length)


 
        if (command === 'Ã§al') {
    if (!msg.guild) {
      
      const ozelmesajuyari = new Discord.RichEmbed()
      .setDescription(`You can not use commands here.`)
      return msg.author.sendEmbed(ozelmesajuyari); }
                const voiceChannel = msg.member.voiceChannel;
    if (!voiceChannel) return msg.channel.sendEmbed(new Discord.RichEmbed()
    .setColor('RANDOM')
    .setDescription(' ? | Ä°lk olarak sesli bir kanala giriÅŸ yapmanÄ±z gerek.'));
                const permissions = voiceChannel.permissionsFor(msg.client.user);
                if (!permissions.has('CONNECT')) {
      return msg.channel.sendEmbed(new Discord.RichEmbed()
      .setColor('RANDOM')
      .setDescription('?? | Åžuanda olduÄŸunuz kanala girmek iÃ§in gerekli izinlere sahip deÄŸilim.'));
                }
                if (!permissions.has('SPEAK')) {
      return msg.channel.sendEmbed(new Discord.RichEmbed()
      .setColor('RANDOM')
      .setDescription('?? | ÅžarkÄ± baÅŸlatÄ±lamÄ±yor. LÃ¼tfen mikrofonumu aÃ§Ä±nÄ±z.'));
                }
 
                if (url.match(/^https?:\/\/(www.youtube.com|youtube.com)\/playlist(.*)$/)) {
                        const playlist = await youtube.getPlaylist(url);
                        const videos = await playlist.getVideos();
                        for (const video of Object.values(videos)) {
                                const video2 = await youtube.getVideoByID(video.id); // ehehehehu videomuzu bulalÄ±m
                                await handleVideo(video2, msg, voiceChannel, true); // ve gÃ¶nderelim
                        }
      return msg.channel.sendEmbed(new Discord.RichEmbed)
      .setDescription(`? | Playlist ? **${playlist.title}** has been added to the queue!`);
                } else {
                        try {
                                var video = await youtube.getVideo(url);
                        } catch (error) {
                                try {
                                        var videos = await youtube.searchVideos(searchString, 10);
                                        let index = 0;
                                        msg.channel.sendEmbed(new Discord.RichEmbed()
                                .setTitle('ÅžarkÄ± SeÃ§imi')
      .setDescription(`${videos.map(video2 => `**${++index} -** ${video2.title}`).join('\n')}`)
       .setFooter('LÃ¼tfen 1-10 arasÄ±nda bir rakam seÃ§iniz 30 saniye iÃ§inde liste iptal edilecektir.')
          .setColor('RANDOM'));
                                        // en fazla 5 tane
                                        try {
                                                var response = await msg.channel.awaitMessages(msg2 => msg2.content > 0 && msg2.content < 11, {
                                                        maxMatches: 1,
                                                        time: 10000,
                                                        errors: ['time']
                                                });
                                        } catch (err) {
                                                console.error(err);
            return msg.channel.sendEmbed(new Discord.RichEmbed()
            .setColor('RANDOM')
            .setDescription('? | ÅžarkÄ± seÃ§imi iptal edildi. '));
                                        }
                                        const videoIndex = parseInt(response.first().content);
                                        var video = await youtube.getVideoByID(videos[videoIndex - 1].id);
                                } catch (err) {
                                        console.error(err);
          return msg.channel.sendEmbed(new Discord.RichEmbed()
          .setColor('RANDOM')
          .setDescription(' ? | Herhangi bir arama sonucu elde edemedim.'));
                                }
                        }
                        return handleVideo(video, msg, voiceChannel);
                }
        } else if (command === 'geÃ§') {
    if (!msg.guild) {
      const ozelmesajuyari = new Discord.RichEmbed()
      .setDescription(`You can not use commands here.`)
      return msg.author.sendEmbed(ozelmesajuyari); }
    if (!msg.member.voiceChannel) return msg.channel.sendEmbed(new Discord.RichEmbed()
    .setColor('RANDOM')
    .setDescription(' ? | LÃ¼tfen Ã¶ncelikle sesli bir kanala katÄ±lÄ±nÄ±z.'));
                if (!serverQueue) return msg.channel.send(' ? | Kuyruk boÅŸ olduÄŸu iÃ§in geÃ§emiyorum. ');
                serverQueue.connection.dispatcher.end('GeÃ§ komudu kullanÄ±ldÄ±.');
                return undefined;
        } else if (command === 'stop') {
    if (!msg.guild) {
      const ozelmesajuyari = new Discord.RichEmbed()
      .setDescription(`You can not use commands here.`)
      return msg.author.sendEmbed(ozelmesajuyari); }
    if (!msg.member.voiceChannel) return msg.channel.sendEmbed(new Discord.RichEmbed()
    .setColor('RANDOM')
    .setDescription(' ? | LÃ¼tfen Ã¶ncelikle sesli bir kanala katÄ±lÄ±nÄ±z.'));
    if (!serverQueue) return msg.channel.sendEmbed(new Discord.RichEmbed()
    .setColor('RANDOM')
    .setDescription(' ? | Åžu anda herhangi bir ÅŸarkÄ± Ã§almÄ±yorum.'));
                serverQueue.songs = [];
                serverQueue.connection.dispatcher.end('Kapat komutu kullanÄ±ldÄ±!');
                return undefined;
        } else if (command === 'ses') {
      if (!msg.guild) {
        const ozelmesajuyari = new Discord.RichEmbed()
        .setDescription(`You can not use commands here.`)
        return msg.author.sendEmbed(ozelmesajuyari); }
    if (!msg.member.voiceChannel) return msg.channel.sendEmbed(new Discord.RichEmbed()
    .setColor('RANDOM')
  .setDescription(' ? | LÃ¼tfen Ã¶ncelikle sesli bir kanala katÄ±lÄ±nÄ±z.'));
    if (!serverQueue) return msg.channel.sendEmbed(new Discord.RichEmbed()
    .setColor('RANDOM')
   .setDescription(' ? | Åžu anda herhangi bir ÅŸarkÄ± Ã§almÄ±yorum.'));
    if (!args[1]) return msg.channel.sendEmbed(new Discord.RichEmbed()
    .setColor('RANDOM')
    .setDescription(` ?? | Ses seviyesi: **${serverQueue.volume}**`));
                serverQueue.volume = args[0];
        if (args[1] > 50) return msg.channel.send({
            embed: {
                title: "",
                color: 0xE50000,
                description: "LÃ¼tfen 10'dan az yada 100 olarak bir sayÄ± belirtin."
            }
        });
                serverQueue.connection.dispatcher.setVolumeLogarithmic(args[1] / 50);
    return msg.channel.sendEmbed(new Discord.RichEmbed()
    .setColor('RANDOM')
   .setDescription('Ses Seviyesi ' + `**${args[1]}**` + ' Olarak AyarlandÄ±.'));
        } else if (command === 'Ã§alÄ±nan') {
   

   
    if (!msg.guild) {
      const ozelmesajuyari = new Discord.RichEmbed()
      .setDescription(`? | Åžu anda hiÃ§bir ÅŸey Ã§almÄ±yorum.`)
      return msg.author.sendEmbed(ozelmesajuyari); }
    if (!serverQueue) return msg.channel.sendEmbed(new Discord.RichEmbed()
    .setColor('RANDOM')
    .setDescription(':x: | Åžu anda hiÃ§bir ÅŸey Ã§almÄ±yorum.'));
    return msg.channel.sendEmbed(new Discord.RichEmbed()
    .setColor('RANDOM')
    .addField('BaÅŸlÄ±k', `[${serverQueue.songs[0].title}](${serverQueue.songs[0].url})`, true)
    .addField("SÃ¼re", `${serverQueue.songs[0].durationm}:${serverQueue.songs[0].durations}`, true))
        } else if (command === 'kuyruk') {
                if (!serverQueue) return msg.channel.send('? | Åžu anda hiÃ§bir ÅŸey Ã§almÄ±yorum. ');
                return msg.channel.sendEmbed(new Discord.RichEmbed()
    .setColor('RANDOM')
     .setTitle('ÅžarkÄ± KuyruÄŸu')
    .setDescription(`${serverQueue.songs.map(song => `**-** ${song.title}`).join('\n')}`))
    .addField('Åžu anda Ã§alÄ±nan: ' + `${serverQueue.songs[0].title}`);
        } else if (command === 'durdur') {
    if (!msg.guild) {
      const ozelmesajuyari = new Discord.RichEmbed()
      .setDescription(`You can not use commands here.`)
      return msg.author.sendEmbed(ozelmesajuyari); }
                if (serverQueue && serverQueue.playing) {
                        serverQueue.playing = false;
                        serverQueue.connection.dispatcher.pause();
      return msg.channel.sendEmbed(new Discord.RichEmbed()
      .setDescription('? | MÃ¼zik durduruldu.')
      .setColor('RANDOM'));
                }
                return msg.channel.send('?? | Åžu anda hiÃ§bir ÅŸey Ã§almÄ±yorum.');
        } else if (command === 'devam') {
    if (!msg.guild) {
      const ozelmesajuyari = new Discord.RichEmbed()
      .setDescription(`Burada komutu kullanamazsÄ±nÄ±z.`)
      return msg.author.sendEmbed(ozelmesajuyari); }
                if (serverQueue && !serverQueue.playing) {
                        serverQueue.playing = true;
                        serverQueue.connection.dispatcher.resume();
      return msg.channel.sendEmbed(new Discord.RichEmbed()
      .setColor('RANDOM')
      .setDescription('? | MÃ¼zik devam ediyor.'));
                }
                return msg.channel.send('? | Åžu anda hiÃ§bir ÅŸey Ã§almÄ±yorum.');
  }
 
        return undefined;
});
 
async function handleVideo(video, msg, voiceChannel, playlist = false) {
        const serverQueue = queue.get(msg.guild.id);
        console.log(video);
        const song = {
                id: video.id,
                title: video.title,
                url: `https://www.youtube.com/watch?v=${video.id}`,
    durationh: video.duration.hours,
    durationm: video.duration.minutes,
                durations: video.duration.seconds,
    views: video.views,
        };
        if (!serverQueue) {
                const queueConstruct = {
                        textChannel: msg.channel,
                        voiceChannel: voiceChannel,
                        connection: null,
                        songs: [],
                        volume: 5,
                        playing: true
                };
                queue.set(msg.guild.id, queueConstruct);
 
                queueConstruct.songs.push(song);
 
                try {
                        var connection = await voiceChannel.join();
                        queueConstruct.connection = connection;
                        play(msg.guild, queueConstruct.songs[0]);
                } catch (error) {
                        console.error(`I could not join the voice channel: ${error}`);
                        queue.delete(msg.guild.id);
                        return msg.channel.send(`HATA | Ses kanalÄ±na katÄ±lamadÄ±m: ${error}`);
                }
        } else {
                serverQueue.songs.push(song);
                console.log(serverQueue.songs);
                if (playlist) return undefined;
    else return msg.channel.sendEmbed(new Discord.RichEmbed()
  .setDescription(`? | **${song.title}** adlÄ± ÅŸarkÄ± baÅŸarÄ±yla kuyruÄŸa eklendi.`)
  .setColor('RANDOM'));
        }
 
        return undefined;
}
 
function play(guild, song) {
        const serverQueue = queue.get(guild.id);
 
        if (!song) {
                serverQueue.voiceChannel.leave();
                queue.delete(guild.id);
                return;
        }
        console.log(serverQueue.songs);
 
        const dispatcher = serverQueue.connection.playStream(ytdl(song.url))
                .on('end', reason => {
                        if (reason === 'AkÄ±ÅŸ yeterince hÄ±zlÄ± diÄŸil.') console.log('ÅžarkÄ± Durduruldu.');
                        else console.log(reason);
                        serverQueue.songs.shift();
                        play(guild, serverQueue.songs[0]);
                })
                .on('error', error => console.error(error));
        dispatcher.setVolumeLogarithmic(serverQueue.volume / 5);
 
   serverQueue.textChannel.sendEmbed(new Discord.RichEmbed()
  .setAuthor(`ÅžarkÄ± Ã‡alÄ±nÄ±yor`, `https://images.vexels.com/media/users/3/137425/isolated/preview/f2ea1ded4d037633f687ee389a571086-youtube-icon-logo-by-vexels.png`)
  .setThumbnail(`https://i.ytimg.com/vi/${song.id}/default.jpg?width=80&height=60`)
  .addField('BaÅŸlÄ±k', `[${song.title}](${song.url})`, true)
  .addField("SÃ¼re", `${song.durationm}:${song.durations}`, true)
  .addField("Ses Seviyesi", `${serverQueue.volume}%`, true)
  .setColor('#FFFFFF'));
}
client.on("message", async msg => {
  
 if (msg.channel.type === "dm") return;
 if(msg.author.bot) return;  
  
  if (msg.content.length > 7) {
    
  db.add(`puancik_${msg.author.id + msg.guild.id}`, 3)
};

  if (db.fetch(`puancik_${msg.author.id + msg.guild.id}`) > 150) {
    
   db.add(`seviye_${msg.author.id + msg.guild.id}`, 1)
    
 db.delete(`puancik_${msg.author.id + msg.guild.id}`)
    
};
  
});


client.on("message", msg => {

  
    const embedlul = new Discord.RichEmbed()
      .setColor(0x00AE86)
      .setDescription(":crown: " + msg.author + " Sonmeztv reklam korumasÄ± aktif, reklam yapmayÄ± bÄ±rak evlat!:crown:")

const embedlulz = new Discord.RichEmbed()
    .setTitle("Sunucunda " + msg.author.tag + "REKLAM YAPIYOR!")
      .setColor(0x00AE86)
      .setDescription("n!warn <kiÅŸi> komutu ile onu uyarabilir ya da n!kick <kiÅŸi> veya n!ban <kiÅŸi> komutlarÄ±nÄ± kullanarak onu sunucudan uzaklaÅŸtÄ±rabilirsin!")
    .addField("KullanÄ±cÄ±nÄ±n mesajÄ±:", "**" + msg.content + "**")

if (msg.content.toLowerCase().match(/(discord\.gg\/)|(discordapp\.com\/invite\/)/g) && msg.channel.type === "text" && msg.channel.permissionsFor(msg.guild.member(client.user)).has("MANAGE_MESSAGES")) {
    if(msg.member.hasPermission('BAN_MEMBERS')){
    return;
    } else {
    msg.delete(30).then(deletedMsg => {
     deletedMsg.channel.send(embedlul)
     msg.guild.owner.send(embedlulz).catch(e => {
            console.error(e);
          });
        }).catch(e => {
          console.error(e);
        });
      };
      };
    })

client.on("guildMemberAdd", async member => {
  
  let sayac = await db.fetch(`sayac_${member.guild.id}`);
  let skanal9 = await db.fetch(`sayacK_${member.guild.id}`);
  if (!skanal9) return;
  const skanal31 = member.guild.channels.find('name', skanal9)
  const sayacgmesaj = await db.fetch(`sayacgm_${member.guild.id}`)
  skanal31.send(sayacgmesaj ? sayacgmesaj.replace('{kullanÄ±cÄ±}', `${member.user}`) .replace('{toplam}', `${sayac}`) .replace('{kalan}', `${sayac - member.guild.members.size}`) : `:inbox_tray: \`${member.user.tag}\` adlÄ± kullanÄ±cÄ± sunucuya katÄ±ldÄ±. \`${sayac}\` kullanÄ±cÄ± olmaya \`${sayac - member.guild.members.size}\` kullanÄ±cÄ± kaldÄ±. (\`${ayarlar.prefix}sayaÃ§-giriÅŸ-mesaj\` komutu ile deÄŸiÅŸtirilebilir.)`)
});

client.on("guildMemberRemove", async member => {
  
  let sayac = await db.fetch(`sayac_${member.guild.id}`);
  let skanal9 = await db.fetch(`sayacK_${member.guild.id}`);
  if (!skanal9) return;
  const skanal31 = member.guild.channels.find('name', skanal9)
  const sayaccmesaj = await db.fetch(`sayaccm_${member.guild.id}`)
 skanal31.send(sayaccmesaj ? sayaccmesaj.replace('{kullanÄ±cÄ±}', `${member.user.tag}`) .replace('{toplam}', `${sayac}`) .replace('{kalan}', `${sayac - member.guild.members.size}`) : `:inbox_tray: \`${member.user.tag}\` adlÄ± kullanÄ±cÄ± sunucudan ayrÄ±ldÄ±. \`${sayac}\` kullanÄ±cÄ± olmaya \`${sayac - member.guild.members.size}\` kullanÄ±cÄ± kaldÄ±. (\`${ayarlar.prefix}sayaÃ§-giriÅŸ-mesaj\` komutu ile deÄŸiÅŸtirilebilir.)`)
});


client.on('message', async message => {
  const ms = require('ms');
  const args = message.content.slice(prefix.length).trim().split(/ +/g);
  const command = args.shift().toLowerCase();
  let u = message.mentions.users.first() || message.author;
  if (command === "botpaneltemizle") {
 if (!message.guild.channels.find(channel => channel.name === "Bot KullanÄ±mÄ±")) return message.channel.send(" Bot Panel ayarlanmamÄ±ÅŸ.")
   if (!message.member.hasPermission('ADMINISTRATOR'))
  return message.channel.send(" Yetkin bulunmuyor.");
    const a = message.guild.channels.find(channel => channel.name === "Bot KullanÄ±mÄ±").delete()
      if(!a) return console.log("guildStats")
      const b = message.guild.channels.find(channel => channel.name === `Bellek KullanÄ±mÄ±: ${(process.memoryUsage().heapUsed / 1024 / 1024).toFixed(2)} MB`).delete()
      if(!b) return console.log("guildStatsMember")
      const c = message.guild.channels.find(channel => channel.name === `KullanÄ±cÄ±lar: ${client.guilds.reduce((a, b) => a + b.memberCount, 0).toLocaleString()}`).delete()
      if(!c) return console.log("guildStatsBot")
      const d = message.guild.channels.find(channel => channel.name === `Toplam Kanal: ${client.channels.size.toLocaleString()}`).delete() //|| message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-1}`).delete() || message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-1}`).delete() || message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-2}`).delete()
      if(!d) return console.log("guildStatsChannel")
         const e = message.guild.channels.find(channel => channel.name === `Ping: ${client.ping}`).delete() //|| message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-1}`).delete() || message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-1}`).delete() || message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-2}`).delete()
      if(!e) return console.log("guildStatsChannel")
            const f = message.guild.channels.find(channel => channel.name === `YapÄ±mcÄ±m: sonmeztv`).delete() //|| message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-1}`).delete() || message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-1}`).delete() || message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-2}`).delete()
      if(!f) return console.log("guildStatsChannel")
               const g = message.guild.channels.find(channel => channel.name === `KÃ¼tÃ¼phanesi: Discord.js`).delete() //|| message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-1}`).delete() || message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-1}`).delete() || message.guild.channels.find(channel => channel.name === `Kanal sayÄ±sÄ±: ${message.guild.channels.size-2}`).delete()
      if(!g) return console.log("guildStatsChannel")
      message.channel.send(" Kanallar temizlendi.")
    }
  if (command === "botpanel") {
  if (message.guild.channels.find(channel => channel.name === "Bot KullanÄ±mÄ±")) return message.channel.send(" Bot Paneli Zaten AyarlanmÄ±ÅŸ.")
  message.channel.send(`Bot Bilgi KanallarÄ±nÄ±n kurulumu baÅŸlatÄ±lsÄ±n mÄ±? baÅŸlatÄ±lacak ise **yes** yazÄ±nÄ±z.`)
      if (!message.member.hasPermission('ADMINISTRATOR'))
  return message.channel.send(" Yetkin bulunmuyor.");
      message.channel.awaitMessages(response => response.content === 'yes', {
        max: 1,
        time: 10000,
        errors: ['time'],
      })
    .then((collected) => {
   message.guild.createChannel('Bot KullanÄ±mÄ±', 'category', [{
  id: message.guild.id,
  deny: ['SPEAK'],
  deny: ['CONNECT']  
}]);
        
 message.guild.createChannel(`Bellek KullanÄ±mÄ±: ${(process.memoryUsage().heapUsed / 1024 / 1024).toFixed(2)} MB`, 'voice')
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "Bot KullanÄ±mÄ±")));
message.guild.createChannel(`KullanÄ±cÄ±lar: ${client.guilds.reduce((a, b) => a + b.memberCount, 0).toLocaleString()}`, 'voice')
.then(channel =>
       channel.setParent(message.guild.channels.find(channel => channel.name === "Bot KullanÄ±mÄ±")));
message.guild.createChannel(`Sunucular: ${client.guilds.size.toLocaleString()}  `, 'voice')
.then(channel =>
             channel.setParent(message.guild.channels.find(channel => channel.name === "Bot KullanÄ±mÄ±")));
message.guild.createChannel(`Toplam Kanal: ${client.channels.size.toLocaleString()}`, 'voice')
.then(channel =>
             channel.setParent(message.guild.channels.find(channel => channel.name === "Bot KullanÄ±mÄ±")));
message.guild.createChannel(`Ping: ${client.ping}`, 'voice')
.then(channel =>
                   channel.setParent(message.guild.channels.find(channel => channel.name === "Bot KullanÄ±mÄ±")));
message.guild.createChannel(`YapÄ±mcÄ±m: sonmeztv`, 'voice')
.then(channel =>
                   channel.setParent(message.guild.channels.find(channel => channel.name === "Bot KullanÄ±mÄ±")));
message.guild.createChannel(`KÃ¼tÃ¼phanesi: Discord.js`, 'voice')
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "Bot KullanÄ±mÄ±")));
  message.channel.send("Bot Bilgi Paneli AyarlandÄ±!")

        })    
    
}
});


client.on('message', message => {
if (message.content === `<@522005758401839116>`) {
 message.channel.sendEmbed(new Discord.RichEmbed()
                           .addField('Merhabalar;', 'Burada Bot HakkÄ±nda KÄ±sa Bir Bilgi Var!')
                           .addField('Hello;', 'Botun sahibi : ! ï¸»èŠ«â•â”€â”€- KÄ°A#6547 dir gerekli bilgiler p!bilgi !')
                           .addField('Prefixim:','n!')
                           .addField('Gecikme:',client.ping)
                           .setColor('RANDOM')
)}
});








client.on("guildMemberAdd", async (message,member) => {
  member.send(new Discord.RichEmbed()
              .setDescription(message.guild.name + 'sunucusuna hoÅŸgeldin' + member.user.username)
              .setColor('RANDOM')
)
});

client.on("guildMemberRemove", async (message,member) => {
  member.send(new Discord.RichEmbed()
              .setDescription(message.guild.name + 'sunucusundan ayrÄ±lmana Ã¼zÃ¼ldÃ¼m' + member.user.username)
              .setColor('RANDOM')
);
//guildCreate
    client.on('guildCreate', guild => {
      const embedCreate = new Discord.RichEmbed()
      .setColor('RANDOM')
      .setTitle('Â» Sunucuya KatÄ±ldÄ±m.')
      .setDescription(`${guild.name} Â» AdlÄ± Sunucuya Eklendim. \n[${guild.memberCount} Â» Ãœye]!`)
      .setFooter('Â» Bir Sunucu Daha (Woodie)lendi', client.user.avatarURL)
      .setTimestamp()
      client.channels.get('529370116068999188').send(embedCreate);
    });
     

//guildDelete
    client.on('guildDelete', guild => {
      const embedDelete = new Discord.RichEmbed()
      .setColor('RANDOM')
      .setTitle('Â» Sunucudan AyrÄ±ldÄ±m.')
      .setDescription(`${guild.name} Â» AdlÄ± Sunucudan AtÄ±ldÄ±m. \n[${guild.memberCount} Â» Ãœye]!`)
      .setFooter('Â» Bir Sunucu Kendini (woodie)den KurtardÄ±', client.user.avatarURL)
      .setTimestamp()
      client.channels.get('535037123229646848').send(embedDelete);
    });
client.on("message", msg => {
    const uyarÄ±embed = new Discord.RichEmbed()
      .setColor(0x00AE86)
      .setDescription("Heey   + msg.author +  ---> Reklam YapmayÄ± Kes Bu Sunucuda Anti-Reklam KorumasÄ± Var. !! ")

const dmembed = new Discord.RichEmbed()
  .setTitle("Sunucunda " + msg.author.tag + " reklam yapÄ±yor!")
  .setColor(0x00AE86)
  .setDescription("Sunucunda Reklam YapÄ±yor n!uyar komutu ile kiÅŸiyi uyara bilirsin fakat `mod-log` kanalÄ±n olmasÄ± lazÄ±m.")
  .addField("KullanÄ±cÄ±nÄ±n mesajÄ±:", "**" + msg.content + "**")

if (msg.content.toLowerCase().match("^(http[s]?:\\/\\/(www\\.)?|ftp:\\/\\/(www\\.)?|www\\.){1}([0-9A-Za-z-\\.@:%_\+~#=]+)+((\\.[a-zA-Z]{2,3})+)(/(.)*)?(\\?(.)*)?") && msg.channel.type === "text" && msg.channel.permissionsFor(msg.guild.member(client.user)).has("MANAGE_MESSAGES")) {
    if(msg.member.hasPermission('BAN_MEMBERS')){
    return;
    } else {
    msg.delete(30).then(deletedMsg => {
     deletedMsg.channel.send(uyarÄ±embed)
     msg.guild.owner.send(dmembed).catch(e => {
            console.error(e);
          });
        }).catch(e => {
          console.error(e);
        });
      };
      };
    })
  });
//reklam tespit edildi bitti
client.on('guildMemberAdd', member => {
  member.addRole(member.guild.roles.find(r => r.name.startsWith('KullanÄ±cÄ±')));
  const channel = member.guild.channels.find('name', 'sonmeztv');
  if (!channel) return;
 const embed = new Discord.RichEmbed()
 .setColor('RANDOM')
 .setAuthor(member.user.tag, member.user.avatarURL || member.user.defaultAvatarURL)
 .setThumbnail(member.user.avatarURL || member.user.defaultAvatarURL)
 .setTitle('Ãœye katÄ±ldÄ±;')
 .setDescription(`Sunucuya katÄ±ldÄ± Toplam [${member.guild.memberCount} Ã¼ye]!`)
 .setFooter('Ñ•ÏƒÎ·Ð¼Ñ”zÑ‚Î½', client.user.avatarURL)
 .setTimestamp()
 channel.send(embed);
});

client.on('guildMemberRemove', member => {
  const channel = member.guild.channels.find('name', 'sonmeztv');
  if (!channel) return;
 const embed = new Discord.RichEmbed()
 .setColor('RANDOM')
 .setAuthor(member.user.tag, member.user.avatarURL || member.user.defaultAvatarURL)
 .setThumbnail(member.user.avatarURL || member.user.defaultAvatarURL)
 .setTitle('Ãœye ayrÄ±ldÄ±;')
 .setDescription(`Sunucudan ayrÄ±ldÄ± [${member.guild.memberCount} Ã¼ye]!`)
 .setFooter('Ñ•ÏƒÎ·Ð¼Ñ”zÑ‚Î½', client.user.avatarURL)
 .setTimestamp()
 channel.send(embed);
});

client.on("guildMemberAdd", async member => {
        let sayac = JSON.parse(fs.readFileSync("./ayarlar/sayac.json", "utf8"));
  let giriscikis = JSON.parse(fs.readFileSync("./ayarlar/sayac.json", "utf8"));  
  let embed = new Discord.RichEmbed()
    .setTitle('')
    .setDescription(``)
 .setColor("RED")
    .setFooter("", client.user.avatarURL);

  if (!giriscikis[member.guild.id].kanal) {
    return;
  }

  try {
    let giriscikiskanalID = giriscikis[member.guild.id].kanal;
    let giriscikiskanali = client.guilds.get(member.guild.id).channels.get(giriscikiskanalID);
    giriscikiskanali.send(`:inbox_tray: **${member.user.tag}** AdlÄ± KullanÄ±cÄ± KatÄ±ldÄ±. \`${sayac[member.guild.id].sayi}\` KiÅŸi OlmamÄ±za \`${sayac[member.guild.id].sayi - member.guild.memberCount}\` KiÅŸi KaldÄ± \`${member.guild.memberCount}\` KiÅŸiyiz!`);
  } catch (e) { // eÄŸer hata olursa bu hatayÄ± Ã¶ÄŸrenmek iÃ§in hatayÄ± konsola gÃ¶nderelim.
    return console.log(e)
  }
});

client.on("guildMemberRemove", async member => {
        let sayac = JSON.parse(fs.readFileSync("./ayarlar/sayac.json", "utf8"));
  let giriscikis = JSON.parse(fs.readFileSync("./ayarlar/sayac.json", "utf8"));  
  let embed = new Discord.RichEmbed()
    .setTitle('')
    .setDescription(``)
 .setColor("RED")
    .setFooter("", client.user.avatarURL);

  if (!giriscikis[member.guild.id].kanal) {
    return;
  }

  try {
    let giriscikiskanalID = giriscikis[member.guild.id].kanal;
    let giriscikiskanali = client.guilds.get(member.guild.id).channels.get(giriscikiskanalID);
    giriscikiskanali.send(`:outbox_tray: **${member.user.tag}** AdlÄ± KullanÄ±cÄ± AyrÄ±ldÄ±. \`${sayac[member.guild.id].sayi}\` KiÅŸi OlmamÄ±za \`${sayac[member.guild.id].sayi - member.guild.memberCount}\` KiÅŸi KaldÄ± \`${member.guild.memberCount}\` KiÅŸiyiz! `)
  } catch (e) { // eÄŸer hata olursa bu hatayÄ± Ã¶ÄŸrenmek iÃ§in hatayÄ± konsola gÃ¶nderelim.
    return console.log(e)
  }

});




client.ayar = db;
client.config = require("./config.js");
require("./modules/functions.js")(client);

client.ayarlar = {
        "sahip": ["520119952850681858"],  //kendi IDnÄ±zÄ± yazÄ±nÄ±z
};

client.on("ready", async () => {
  client.appInfo = await client.fetchApplication();
  setInterval( async () => {
    client.appInfo = await client.fetchApplication();
  }, 60000);
  
  require("./modules/dashboard.js")(client);
});


client.on('message', message => {
    if (message.content.startsWith("baÄŸlantÄ±")) {
        message.channel.createInvite({
        thing: true,
        maxUses: 10,
        maxAge: 86400,
    }).then(invite =>
      message.author.sendMessage(invite.url)
    )
    const embed = new Discord.RichEmbed()
        .setColor("RANDOM")
          .setDescription("BaÄŸlantÄ± Ã¶zel bir mesajla gÃ¶nderildi :link:")
           .setAuthor(client.user.username, client.user.avatarURL)
                 .setAuthor(client.user.username, client.user.avatarURL)
                .setFooter('TarafÄ±ndan talep edildi: ' + message.author.tag)

      message.channel.sendEmbed(embed).then(message => {message.delete(10000)})
              const Embed11 = new Discord.RichEmbed()
        .setColor("RANDOM")
        
    .setDescription("** BaÄŸlantÄ± sÃ¼resi | BaÄŸlantÄ±nÄ±n kullanÄ±m sayÄ±sÄ±: 10 **")
      message.author.sendEmbed(Embed11)
    }
});

client.on('guildMemberAdd', member => {
  let guild = member.guild;
  let joinRole = guild.roles.find('name', 'Ãœye'); 
  member.addRole(joinRole); 

  const channel = member.guild.channels.find('name', 'sonmeztv');
  if (!channel) return;
  const embed = new Discord.RichEmbed()
  .setColor('RANDOM')
  .setAuthor(member.user.username, member.user.avatarURL)
  .setThumbnail(member.user.avatarURL)
  .setTitle('ðŸ“¥ | Sunucuya katÄ±ldÄ±!')
  .setTimestamp()
  channel.sendEmbed(embed); 
});

client.on('guildMemberRemove', member => {
  const channel = member.guild.channels.find('name', 'sonmeztv');
  if (!channel) return;
  const embed = new Discord.RichEmbed()
  .setColor('RANDOM')
  .setAuthor(member.user.username, member.user.avatarURL)
  .setThumbnail(member.user.avatarURL)
  .setTitle('ðŸ“¤ | Sunucudan ayrÄ±ldÄ±')
  .setTimestamp()
  channel.sendEmbed(embed); 
});


client.login(ayarlar.token);